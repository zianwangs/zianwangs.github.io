<style type="text/css">
    body {
        margin: 0;
        padding: 0;
    }

    #Symbol {
        position: relative;
        float: left;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 150px;
        line-height: 150px;
        font-family: Times;
    }

    text {
        font-size: 100px;
    }
</style>


<body id = "b">
    <div id="Symbol"></div>
    
</body>

<audio id="myaudio" loop="true" type="audio/mp3">
</audio>

<script>
    const TONES = 12;
    /* TODO: parallel */
    // const parallels = [

    // ];
    const keySigs = {
        0: "C",
        1: "C<text>♯</text>",
        2: "D",
        3: "E<text>♭</text>",
        4: "E",
        5: "F",
        6: "F<text>♯</text>",
        7: "G",
        8: "A<text>♭</text>",
        9: "A",
        10: "B<text>♭</text>",
        11: "B",
    };
    var curParallel = 0;
    var curTone = 7 /* G */;
    var audio = document.getElementById("myaudio");
    audio.src = "static/audios/" + curTone + "/" + curParallel;
    var symbol = document.getElementById("Symbol");
    symbol.innerHTML = keySigs[curTone];
    var playing = false;
    var audioPlayController = () => {
        if (playing = !playing) {
            let playPromise = audio.play();
            playPromise.catch((_) => {});
        } else {
            audio.pause();
        }
    };
    var audioSwitchController = (delta) => {
        curTone = (curTone + delta + TONES) % TONES;
        symbol.innerHTML = keySigs[curTone];
        audio.src = "static/audios/" + curTone + "/" + curParallel;
        if (playing) {
            let playPromise = audio.play();
            playPromise.catch((_) => {});
        }
    }
    b.onclick = audioPlayController;
    b.onkeyup = function(e) {
        if (e.keyCode == 13 /* Enter */ || e.keyCode == 32 /* Space */) {
            audioPlayController();
        } else if (e.keyCode == 87 /* W */ || e.keyCode == 38 /* Up */) {
            /* TODO */
        } else if (e.keyCode == 83 /* S */ || e.keyCode == 40 /* Down */) {
            /* TODO */
        } else if (e.keyCode == 68 /* D */ || e.keyCode == 39 /* Right */) {
            audioSwitchController(1);
        } else if (e.keyCode == 65 /* A */ || e.keyCode == 37 /* Left */) {
            audioSwitchController(-1);
        }	
    };
    var touchStartX, touchStartY, touchStartTime;
    var handleTouchStart = (e) => {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
        touchStartTime = Date.now();
    };
    var handleTouchEnd = (e) => {
        let deltaX = e.changedTouches[0].clientX - touchStartX;
        let deltaY = e.changedTouches[0].clientY - touchStartY;
        if (Date.now() - touchStartTime < 50) {
            return;
        } else if (Math.abs(deltaX) - Math.abs(deltaY) < 70) {
            return;
        } else if (deltaX > 0) {
            audioSwitchController(-1);
        } else {
            audioSwitchController(1);
        }
    };
    document.addEventListener("touchstart", e => handleTouchStart(e));
    document.addEventListener("touchend", e => handleTouchEnd(e));

</script>
